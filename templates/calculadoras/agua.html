{% extends 'base.html' %}
{% load static %}
{% block title %}Calculadora de Riego - AgroPredict{% endblock %}
{% block content %}

<style>
.form-section {
    background: white;
    border-radius: 8px;
    padding: 25px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    margin-bottom: 20px;
}
.result-card {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 15px;
}
.nutrient-bar {
    height: 20px;
    border-radius: 10px;
    background: #e9ecef;
    overflow: hidden;
    position: relative;
}
.nutrient-fill {
    height: 100%;
    transition: width 0.3s ease;
    background: #03a9f4;
}
.formula-explanation {
    background: #e1f5fe;
    border-left: 4px solid #03a9f4;
    padding: 15px;
    margin: 20px 0;
}
</style>

<div class="container">
    <div class="row">
        <div class="col-12">
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'calculadoras_agricolas' %}">Calculadoras</a></li>
                    <li class="breadcrumb-item active">Calculadora de Riego</li>
                </ol>
            </nav>
            
            <div class="d-flex align-items-center mb-4">
                <i class="fas fa-tint text-info me-3" style="font-size: 2.5rem;"></i>
                <div>
                    <h1 class="h3 mb-1">Calculadora de Riego</h1>
                    <p class="text-muted mb-0">Método de cálculo de lámina de riego basado en evapotranspiración</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-6">
            <form method="post">
                {% csrf_token %}
                
                <!-- Datos de Entrada -->
                <div class="form-section">
                    <h5 class="text-info mb-3">
                        <i class="fas fa-tint me-2"></i>
                        Datos de Entrada
                    </h5>
                    
                    <div class="mb-3">
                        <label for="et0" class="form-label">ET₀ - Evapotranspiración de Referencia (mm/día)</label>
                        <input type="number" class="form-control" name="et0" id="et0" 
                               step="0.1" min="0" required placeholder="ej: 5.3">
                        <div class="form-text">Dato disponible en estaciones meteorológicas o CNR</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="kc" class="form-label">Coeficiente de Cultivo (Kc)</label>
                        <select class="form-select" name="kc" id="kc">
                            <option value="0.5">0.5 - Etapa Inicial</option>
                            <option value="0.8">0.8 - Desarrollo</option>
                            <option value="1.0" selected>1.0 - Media Temporada</option>
                            <option value="1.15">1.15 - Máximo</option>
                            <option value="0.7">0.7 - Final</option>
                        </select>
                        <div class="form-text">Varía según la etapa fenológica del cultivo</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="eficiencia" class="form-label">Eficiencia del Sistema de Riego</label>
                        <select class="form-select" name="eficiencia" id="eficiencia">
                            <option value="0.90">90% - Goteo tecnificado</option>
                            <option value="0.80">80% - Goteo estándar</option>
                            <option value="0.70" selected>70% - Aspersión</option>
                            <option value="0.60">60% - Surco mejorado</option>
                            <option value="0.45">45% - Surco tradicional</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="frecuencia" class="form-label">Frecuencia de Riego (días)</label>
                        <input type="number" class="form-control" name="frecuencia" id="frecuencia" 
                               min="1" max="30" value="7" required>
                        <div class="form-text">Días entre cada evento de riego</div>
                    </div>
                </div>

                <div class="d-grid">
                    <button type="submit" class="btn btn-info btn-lg">
                        <i class="fas fa-calculator me-2"></i>
                        Calcular Lámina de Riego
                    </button>
                </div>
            </form>
        </div>

        <div class="col-lg-6">
            {% if resultado %}
            <div class="form-section">
                <h5 class="text-success mb-3">
                    <i class="fas fa-chart-bar me-2"></i>
                    Resultados del Cálculo
                </h5>

                <!-- Resultado Principal -->
                <div class="result-card">
                    <h6 class="text-info mb-3">Lámina de Riego</h6>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span>Lámina Diaria Requerida</span>
                            <span><strong>{{ resultado.lamina_diaria }} mm/día</strong></span>
                        </div>
                        <div class="nutrient-bar">
                            <div class="nutrient-fill" style="width: {% widthratio resultado.lamina_diaria 10 100 %}%"></div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span>Lámina por Evento</span>
                            <span><strong>{{ resultado.lamina_evento }} mm</strong></span>
                        </div>
                        <div class="nutrient-bar">
                            <div class="nutrient-fill" style="width: {% widthratio resultado.lamina_evento 100 100 %}%"></div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span>Volumen por Evento</span>
                            <span><strong>{{ resultado.volumen_evento }} m³/ha</strong></span>
                        </div>
                        <div class="nutrient-bar">
                            <div class="nutrient-fill" style="width: {% widthratio resultado.volumen_evento 1000 100 %}%"></div>
                        </div>
                    </div>
                </div>

                <!-- Recomendaciones -->
                <div class="result-card">
                    <h6 class="text-info mb-3">Recomendaciones</h6>
                    <ul class="mb-0">
                        <li>Ajustar frecuencia según tipo de suelo</li>
                        <li>Monitorear humedad del suelo regularmente</li>
                        <li>Considerar precipitaciones en el periodo</li>
                    </ul>
                </div>
            </div>
            {% else %}
            <!-- Información educativa -->
            <div class="form-section">
                <h5 class="text-info mb-3">
                    <i class="fas fa-graduation-cap me-2"></i>
                    Método de Cálculo
                </h5>
                
                <div class="formula-explanation">
                    <h6>Fórmula Base:</h6>
                    <p><strong>Lámina = (ET₀ × Kc × Días) / Eficiencia</strong></p>
                </div>
                
                <h6>Pasos del Cálculo:</h6>
                <ol>
                    <li><strong>Evapotranspiración del Cultivo (ETc):</strong> Se calcula multiplicando ET₀ por el coeficiente de cultivo (Kc)</li>
                    <li><strong>Lámina por Evento:</strong> ETc multiplicado por los días entre riegos, ajustado por eficiencia del sistema</li>
                    <li><strong>Volumen de Agua:</strong> Conversión a m³/ha (1 mm = 10 m³/ha)</li>
                </ol>
                
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Importante:</strong> Los coeficientes Kc varían según la etapa fenológica del cultivo. Consultar tablas específicas para cada especie.
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

{% endblock %}